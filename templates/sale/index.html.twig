{% extends 'layout.html.twig' %}

{% block title %}Sale index{% endblock %}

{% block body %}
    <h1 class="font-bold">
        Ventes
    </h1>

    {{ form_start(form, {'action': path('app_sale_new'), 'method': 'POST'}) }}
    <div class="w-full">
        <div class="grid lg:grid-cols-6 md:grid-cols-3 sm:grid-cols-1 gap-2 text-xs">
            <div class="content-center">
                {{ form_label(form.soldOn, 'Date') }}
                {{ form_widget(form.soldOn, {'attr': {'class': 'focus:outline-none block w-full rounded-md border border-gray-200 dark:border-gray-600 bg-transparent p-2 text-gray-600 transition duration-300 invalid:ring-2 invalid:ring-red-400 focus:ring-2 focus:ring-cyan-300'}}) }}
            </div>
            <div class="content-center">
                {{ form_label(form.item, 'Artcile') }}
                {{ form_widget(form.item, {'attr': {'class': 'focus:outline-none block w-full rounded-md border border-gray-200 dark:border-gray-600 bg-transparent p-2 text-gray-600 transition duration-300 invalid:ring-2 invalid:ring-red-400 focus:ring-2 focus:ring-cyan-300'}}) }}
            </div>
            <div class="content-center">
                {{ form_label(form.qty, 'Vente') }}
                {{ form_widget(form.qty, {'attr': {'class': 'focus:outline-none block w-full rounded-md border border-gray-200 dark:border-gray-600 bg-transparent p-2 text-gray-600 transition duration-300 invalid:ring-2 invalid:ring-red-400 focus:ring-2 focus:ring-cyan-300'}}) }}
            </div>
            <div class="content-center">
                {{ form_label(form.qtyReturned, 'Retour') }}
                {{ form_widget(form.qtyReturned, {'attr': {'class': 'focus:outline-none block w-full rounded-md border border-gray-200 dark:border-gray-600 bg-transparent p-2 text-gray-600 transition duration-300 invalid:ring-2 invalid:ring-red-400 focus:ring-2 focus:ring-cyan-300'}}) }}
            </div>
            <div class="content-center">
                {{ form_label(form.received, 'Encaissé') }}
                {{ form_widget(form.received, {'attr': {'class': 'focus:outline-none block rounded-md border border-gray-200 dark:border-gray-600 bg-transparent p-2 text-gray-600 transition duration-300 invalid:ring-2 invalid:ring-red-400 focus:ring-2 focus:ring-cyan-300 my-2'}}) }}
            </div>
            <div class="hidden">
                {{ form_widget(form.registeredBy) }}
            </div>
            <div class="content-center">
                <button type="submit" class="rounded bg-sky-400 relative flex h-9 items-center justify-center px-4 before:absolute before:inset-0 before:rounded-full before:bg-primary before:transition before:duration-300 hover:before:scale-105 active:duration-75 active:before:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                </button>
            </div>
        </div>
        {{ form_widget(form) }}
    </div>
    {{ form_end(form) }}

    <table class="border-collapse table-auto w-full text-xs mt-4">
        <thead>
            <tr>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Créée par</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Date</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Article</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Vente</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Retour</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">PU</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Montant</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Encaissé</th>
                <th class="border-b dark:border-slate-600 font-medium p-2 pl-8 pt-0 pb-3 text-slate-400 dark:text-slate-200 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for sale in sales %}
            <tr class="text-xs">
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.registeredBy.email|split('@')[0] }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.soldOn ? sale.soldOn|date('d/m/Y') : '' }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.item.label }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.qty }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.qtyReturned }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400 text-nowrap">{{ sale.item.sellPrice|number_format(2, ",", " ") }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400 text-nowrap">{{ ((sale.qty - sale.qtyReturned) * sale.item.sellPrice)|number_format(2, ",", " ") }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">{{ sale.received ? 'Oui' : 'Non' }}</td>
                <td class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">
                    <a href="{{ path('app_sale_edit', {'id': sale.id}) }}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                        </svg>
                    </a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="9" class="border-b border-slate-100 dark:border-slate-700 p-2 pl-8 text-slate-500 dark:text-slate-400">No records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
